<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
<meta charset=utf-8>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T8HDQQNE6X"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-T8HDQQNE6X')</script>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=description content>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=keywords content>
<meta property="og:type" content="article">
<meta property="og:description" content>
<meta property="og:title" content="Tutorial: Mayhem bot – Part 3">
<meta property="og:site_name" content="The Personal Blog of Basil Labib">
<meta property="og:image" content>
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:width" content>
<meta property="og:image:height" content>
<meta property="og:url" content="https://basil08.github.io/post/tutorial-mayhem-bot-part-3/">
<meta property="og:locale" content="en-us">
<meta property="article:published_time" content="2021-10-12
"> <meta property="article:modified_time" content="2021-10-12
">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@BasilLabib">
<meta name=twitter:creator content="@BasilLabib">
<meta name=twitter:title content="Tutorial: Mayhem bot – Part 3 | The Personal Blog of Basil Labib">
<meta name=twitter:description content="In the last part of this guide, we looked at creating our first command, Discord.MessageEmbed(), and modularization. In this part, we&rsquo;ll demonstrate API fetching and command aliases, while adding two new commands to our bot!
meow & node-fetch The meow command is a simple command that queries a public API of cat pictures and sends one random, cute cat picture down in the channel. We will use the following endpoint:|">
<meta name=twitter:image:src content>
<meta name=twitter:domain content="https://basil08.github.io/post/tutorial-mayhem-bot-part-3/">
<title>Tutorial: Mayhem bot – Part 3</title>
<link rel=canonical href=https://basil08.github.io/post/tutorial-mayhem-bot-part-3/>
<link rel=stylesheet href=https://unpkg.com/tachyons@4.11.1/css/tachyons.min.css>
<link rel=stylesheet href=https://basil08.github.io/css/style.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/highlightjs@9.12.0/styles/github-gist.css>
<link rel=stylesheet href=https://basil08.github.io/mycss/custom.css>
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon href=/apple-touch-icon.png>
<script src=//cdn1.lncld.net/static/js/3.0.4/av-min.js></script>
<script src=//unpkg.com/valine/dist/Valine.min.js></script>
</head>
<body lang=en-us class="sans-serif w-90 w-80-m w-60-ns center mv2 mv5-ns" itemscope itemtype=http://schema.org/Article>
<span class=b>/ </span>
<a href=https://basil08.github.io/ class="b bb bw1 pb1 no-underline black">The Personal Blog of Basil Labib</a>
<span class=b> / </span>
<a href=/post class="b bb bw1 pb1 no-underline black">blog</a>
<section id=main class=mt5>
<h1 itemprop=name id=title>Tutorial: Mayhem bot – Part 3</h1>
<span class="f6 gray">October 12, 2021</span>
<article itemprop=articleBody id=content class="w-90 lh-copy">
<p>In the <a href=/post/tutorial-mayhem-bot-part-2/>last part</a> of this guide, we looked at creating our first command, <code>Discord.MessageEmbed()</code>, and modularization. In this part, we&rsquo;ll demonstrate API fetching and command aliases, while adding two new commands to our bot!</p>
<h2 id=meow-amp-node-fetch><code>meow</code> & <code>node-fetch</code></h2>
<p>The <code>meow</code> command is a simple command that queries a public API of cat pictures and sends one random, cute cat picture down in the channel. We will use the following endpoint:</p>
<pre tabindex=0><code>https://aws.random/cat/meow
</code></pre><p><strong>NOTE</strong>: If you wish to use an API that requires some kind of authorization, then you have to generate a secret key from a dashboard usually and feed this credential to your <code>.env</code> file (this step is more or less platform-dependent. For eg: <a href=https://replit.com>replit</a> provides a key-value based secret storage feature). Then, you can read that value via <code>process.env.API_SECRET_KEY</code> or likewise. Consult your API documentation and hosting provider documentation.</p>
<p>But to fetch on the server-side, we have to install a <code>fetch</code>-equivalent module on our server. This is achieved by the <code>node-fetch</code> package.</p>
<pre tabindex=0><code>yarn add node-fetch # or npm install node-fetch
</code></pre><p>Now, let us implement the <code>meow</code> command.</p>
<pre tabindex=0><code>// New file: /commands/meow.js 
const fetch = require('node-fetch');
const {prefix} = require('../config.json');

module.exports = {
	name: 'meow',
	description: 'Coz everyone likes cats!',
	usage: `${prefix}meow`,
	cooldown: 10,
	execute(message, args){
		const file = fetch('https://aws.random.cat/meow')
			.then(file =&gt; file.text())
			.catch(err =&gt; { 
				console.error(err);
				message.channel.send(`An Error was encountered while executing that command.`);
			});
		message.channel.send(JSON.parse(file).file);

	}
}
</code></pre><figure><img src=/img/may3/1.jpg alt="The meow command"><figcaption>
<p>The meow command</p>
</figcaption>
</figure>
<p>Once again, the code is obvious and there is no element that requires an explanation as such. The &ldquo;cooldown&rdquo; parameter will be dealt with in another command. But, you can probably guess it is to prevent a indirect DDoS attack on the cat server by bad actors and/or bots.</p>
<h2 id=help><code>help</code></h2>
<p>Good UI/UX don&rsquo;t require a manual to be used. So, like every good software, we will provide a handy help command for potentially new users of our bot. This command will demonstrate sending personal direct messages and command aliases.</p>
<p>The design of the messages is decoupled from the logic. Feel free to make your bot as snazzy as possible.</p>
<pre tabindex=0><code>// New file: /commands/help.js
const {prefix, version,bot_name, bot_author} = require('../config.json');
const Discord = require('discord.js');

module.exports = {
	name: 'help',
	description: 'Display all available commands',
	aliases: ['h','?'],
	execute(message, args){
		const data = [];
		const {commands} = message.client;

		if(!args.length){
			// show all commands
			data.push(`This is the ${bot_name} Bot version ${version}`);
			data.push(commands.map(command =&gt; command.name).join(', '));
			data.push(`Use ${prefix}help [command name] to get details about [command name]`);
			data.push(`All commands are prefixed by the ${prefix}`);
			data.push(`\n\nSend your love to ${bot_author} ;)`);

			// split: true splits the message into separate messages if char count &gt; 2000
			return message.author.send(data, {split: true})
				.then(() =&gt; {	// DM as help message can get messy
					if(message.channel.type === 'dm') return;
					message.reply('I\'ve sent you a DM');
				})
				.catch(error =&gt; {  // the case when user has DM disabled must be gracefully handled
					console.error(`Could not send help DM to ${message.author.tag}.\n`,error);
					message.reply('I can\'t DM you. Do you have DMs disabled?');
				});
		}else{
      ...
</code></pre><p>As you can see, <code>message.author.send(...)</code> is used to send a message to the original message author&rsquo;s DM. If a bare <code>help</code> is invoked, we inform the user of our commands personally and ask them to explore more by using the format <code>help [command name]</code>.</p>
<p>Once again, the aliases field will come handy in the next part of this function.</p>
<pre tabindex=0><code>...
	}else{
			const name = args[0].toLowerCase();

      // try to make a hit, either the command or its aliases
			const command = commands.get(name) || commands.find(c =&gt; c.aliases &amp;&amp; c.aliases.includes(name));

			if(!command){
				return message.reply('Not a valid command -_-');
			}

			const embed = new Discord.MessageEmbed()
			.setTitle(`Help for ${command.name}`)
			.setColor('#02fede')
			.addFields(
				{name: 'Aliases', value: (command.aliases) ? `${command.aliases.join(', ')}`: 'There are no aliases for this command!'},
				{name: 'Description', value: (command.description) ? `${command.description}`: 'Currently no description available!'},
				{name: 'Usage', value: (command.usage) ? `${command.usage}`:'Currently no usage available!'},
				{name: 'Cooldown', value: (command.cooldown) ? `${command.cooldown} second(s)`: 'This command has no cooldown!'}
			)
			.setTimestamp();

			message.channel.send(embed);
		}
	}
}

</code></pre><figure><img src=/img/may3/0.jpg alt="help meow command execution"><figcaption>
<p><code>help meow</code> command execution</p>
</figcaption>
</figure>
<p>You can probably understand the workflow that <code>discord.js</code> promulgates. Here it is:</p>
<blockquote>
<p>PARSE ➡ EXECUTE ➡ SEND</p>
</blockquote>
<h2 id=upcoming>UPCOMING</h2>
<p>In this post, we finally made an API call from our bot and served some cute cat pictures to our users. Now, the sky&rsquo;s the limit for you! Moreover, we added a help command to be more organized.</p>
<p>In the next part, we&rsquo;ll look at pre-fetching, cooldowns, and exclusive commands.</p>
<div style="border-top:1px solid gray;border-bottom:1px solid gray;padding:1rem;padding-top:0">
<div>
<p>
<span style=font-size:larger;font-weight:700>Basil</span>
| <a href=https://twitter.com/BasilLabib>@BasilLabib</a>
</p>
<p style=margin:0%;color:#1a1818>
Tech, Science, Design, Economics, Finance, Books, Philosophy, Psychology.<br>
Basil blogs about complex topics in simple words.<br>
This blog is his passion project.
</p>
</div>
</div>
</article>
<span class="f6 gray mv3" title="Lastmod:  October 12, 2021. Published at: 2021-10-12.">
</span>
<section class=mt4>
<h3>👋 Related posts in the <a href=/series/build-a-discord-bot-a-definitive-guide class="b bb bw1 pb1 no-underline black">Build a Discord bot: A definitive guide</a> series...</h3>
<ul class="list pl0">
<li class="list pl0 lh-copy">
<a class="f4 b dib black no-underline" href=https://basil08.github.io/post/tutorial-mayhem-bot-part-2/>Tutorial: Mayhem bot – Part 2</a>
<span class="f6 gray">October 9, 2021</span>
</li>
<li class="list pl0 lh-copy">
<a class="f4 b dib black no-underline" href=https://basil08.github.io/post/tutorial-mayhem-bot-part-1/>Tutorial: Mayhem bot – Part 1</a>
<span class="f6 gray">October 8, 2021</span>
</li>
</ul>
</section>
<div id=vcomment></div>
<script>new Valine({el:'#vcomment',appId:'feK7nt01ATB0bsSY0zMD3mxA-MdYXbMMI',appKey:'z1UFShUc40oPkqO8v8nKXG2a',lang:'en'})</script>
</section>
<footer>
<div>
<p class="f6 gray mt6 lh-copy">
© 2020 <a href=https://twitter.com/BasilLabib>Basil Labib</a> | Made with ❤️ using <a href=https://gohugo.io>Hugo</a> & <a href=https://github.com/siegerts/hugo-theme-basic>Basic</a>
</p>
</div>
</footer>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>